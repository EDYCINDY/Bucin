<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembuat Tautan Pendek (via Google Sheet)</title>
    <style>
        /* === CSS untuk Link Shortener (Google Sheet Version) === */

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: #f8f9fa;
            /* Warna latar belakang halaman sedikit abu-abu */
            color: #343a40;
            /* Warna teks utama sedikit lebih gelap */
            padding: 20px;
            max-width: 650px;
            /* Batasi lebar konten agar tidak terlalu lebar di layar besar */
            margin: 20px auto;
            /* Pusatkan konten di halaman */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            /* Tambahkan sedikit bayangan */
            border-radius: 8px;
            /* Sudut sedikit melengkung */
            background-color: #ffffff;
            /* Latar belakang area konten putih */
        }

        h1 {
            color: #0056b3;
            /* Warna biru untuk judul utama */
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #dee2e6;
            /* Garis bawah tipis */
            padding-bottom: 10px;
        }

        p {
            color: #6c757d;
            /* Warna abu-abu untuk teks deskripsi */
            margin-bottom: 20px;
            text-align: center;
            /* Pusatkan teks intro */
        }

        label {
            display: block;
            /* Label di atas input */
            margin-bottom: 6px;
            /* Jarak antara label dan input */
            font-weight: 600;
            /* Sedikit lebih tebal */
            color: #495057;
        }

        /* Styling untuk semua jenis input teks */
        input[type="url"],
        input[type="text"],
        input[type="password"] {
            display: block;
            /* Input mengambil lebar penuh */
            width: 95%;
            /* Sedikit kurang dari 100% untuk padding */
            padding: 12px 15px;
            /* Padding di dalam input */
            margin-bottom: 18px;
            /* Jarak di bawah setiap input */
            border: 1px solid #ced4da;
            /* Border abu-abu */
            border-radius: 4px;
            /* Sudut input melengkung */
            font-size: 1rem;
            /* Ukuran font standar */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            /* Transisi halus saat focus */
        }

        /* Efek saat input di-klik (focus) */
        input[type="url"]:focus,
        input[type="text"]:focus,
        input[type="password"]:focus {
            border-color: #80bdff;
            /* Border biru saat focus */
            outline: 0;
            /* Hilangkan outline default */
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            /* Bayangan biru lembut saat focus */
        }

        button {
            display: block;
            /* Tombol mengambil lebar penuh */
            width: 100%;
            /* Lebar penuh */
            padding: 12px 20px;
            background-color: #007bff;
            /* Warna biru utama */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            /* Tanda cursor tangan */
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
            /* Teks huruf besar */
            letter-spacing: 0.5px;
            /* Sedikit jarak antar huruf */
            transition: background-color 0.2s ease, transform 0.1s ease;
            /* Transisi halus */
            margin-top: 25px;
            /* Jarak di atas tombol */
        }

        button:hover {
            background-color: #0056b3;
            /* Warna biru lebih gelap saat hover */
        }

        button:active {
            transform: scale(0.98);
            /* Efek sedikit mengecil saat diklik */
        }

        /* Area hasil */
        #result {
            margin-top: 30px;
            background-color: #e9ecef;
            /* Latar belakang abu-abu muda untuk hasil */
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            display: none;
            /* Tetap tersembunyi secara default */
            word-wrap: break-word;
            /* Pastikan URL panjang tidak merusak layout */
        }

        #result h2 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #495057;
        }

        /* Styling untuk preview URL pendek */
        #shortUrlPreview {
            font-family: 'Courier New', Courier, monospace;
            /* Font Monospace untuk URL */
            background-color: #f8f9fa;
            padding: 3px 6px;
            border-radius: 3px;
            border: 1px dashed #adb5bd;
            /* Border putus-putus */
            display: inline-block;
            /* Agar background tidak full width */
        }

        /* Styling untuk pesan respons dari server */
        #server-response {
            margin-top: 15px;
            padding: 12px 15px;
            /* Padding lebih besar */
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
            font-size: 0.95rem;
            border-width: 1px;
            border-style: solid;
        }

        /* Kelas untuk pesan sukses */
        .success {
            color: #155724;
            /* Teks hijau tua */
            background-color: #d4edda;
            /* Latar hijau muda */
            border-color: #c3e6cb;
            /* Border hijau */
        }

        /* Kelas untuk pesan error */
        .error {
            color: #721c24;
            /* Teks merah tua */
            background-color: #f8d7da;
            /* Latar merah muda */
            border-color: #f5c6cb;
            /* Border merah */
        }

        input[type="password"] {
            width: 90%;
            max-width: 400px;
            padding: 8px;
        }

        #result {
            /* ... */
        }

        #server-response {
            margin-top: 15px;
            font-weight: bold;
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <h1>Pembuat Tautan Pendek (via Google Sheet)</h1>
    <p>Masukkan URL panjang dan kode pendek. Tautan akan ditambahkan langsung ke Google Sheet.</p>

    <label for="longUrl">URL Panjang:</label>
    <input type="url" id="longUrl" placeholder="https://contoh-url-panjang-anda.com/..." required>

    <label for="shortCode">Kode Pendek (opsional, biarkan kosong untuk acak):</label>
    <input type="text" id="shortCode" placeholder="mis: blog-baru">

    <label for="secretKey">Kunci Rahasia:</label>
    <input type="password" id="secretKey" required placeholder="Masukkan kunci rahasia dari Apps Script">

    <button onclick="addLink()">Tambahkan Tautan</button>

    <div id="result" style="display: none;">
        <h2>Hasil Sementara:</h2>
        <p><strong>Tautan Pendek yang Akan Dibuat:</strong> <span id="shortUrlPreview"></span></p>
        <div id="server-response"></div>
    </div>

    <script>
        // !!! GANTI DENGAN URL WEB APP ANDA !!!
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyWpgCokR45ULA1XnCqXCtI5bf-OoqVeVV-NlMuZiNbZca4Ar4BpATP1Nw_lQuZYssC/exec";
        // !!! GANTI USERNAME & REPO_NAME untuk preview URL !!!
        const githubUsername = "edycindy";
        const githubRepoName = "Shortener";

        function generateRandomString(length = 6) {
            const characters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function addLink() {
            const longUrlInput = document.getElementById('longUrl');
            const shortCodeInput = document.getElementById('shortCode');
            const secretKeyInput = document.getElementById('secretKey');
            const resultDiv = document.getElementById('result');
            const shortUrlPreviewSpan = document.getElementById('shortUrlPreview');
            const serverResponseDiv = document.getElementById('server-response');

            const longUrl = longUrlInput.value.trim();
            let shortCode = shortCodeInput.value.trim();
            const secretKey = secretKeyInput.value.trim();

            // Reset tampilan hasil sebelumnya
            serverResponseDiv.textContent = '';
            serverResponseDiv.className = '';
            resultDiv.style.display = 'none';

            if (!longUrl || !secretKey) {
                alert('URL Panjang dan Kunci Rahasia tidak boleh kosong!');
                return;
            }
            try { new URL(longUrl); } catch (_) { alert('URL Panjang tidak valid.'); return; }

            if (!shortCode) {
                shortCode = generateRandomString();
                shortCodeInput.value = shortCode; // Update input field
            } else {
                shortCode = shortCode.replace(/[^a-zA-Z0-9-]/g, '');
                if (!shortCode) {
                    alert('Kode Pendek tidak valid. Gunakan huruf, angka, atau tanda hubung (-).');
                    return; // Jangan fallback, biar user perbaiki
                }
            }

            // Tampilkan preview
            const baseUrl = `https://${githubUsername}.github.io/${githubRepoName}/`;
            const finalShortUrl = baseUrl + shortCode;
            shortUrlPreviewSpan.textContent = finalShortUrl;
            resultDiv.style.display = 'block';
            serverResponseDiv.textContent = 'Mengirim data ke server...';

            // Data untuk dikirim ke Apps Script (POST)
            const postData = {
                secret: secretKey,
                shortCode: shortCode,
                longUrl: longUrl
            };

            // Kirim data ke Google Apps Script Web App (POST)
            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'cors', // Diperlukan untuk cross-origin request
                cache: 'no-cache',
                // Penting: Redirect 'follow' mungkin tidak berfungsi seperti yang diharapkan
                // dengan Apps Script saat POST, 'manual' bisa membantu debug jika perlu
                redirect: 'follow',
                headers: {
                    // Tipe konten HARUS 'text/plain' untuk Apps Script doPost default
                    // meskipun kita mengirim JSON stringified. Apps Script akan parse.
                    'Content-Type': 'text/plain;charset=utf-8',
                },
                // Kirim data sebagai string JSON
                body: JSON.stringify(postData)
            })
                .then(response => response.json()) // Harapkan JSON kembali dari Apps Script
                .then(data => {
                    console.log("Respons server:", data);
                    if (data && data.status === "success") {
                        serverResponseDiv.textContent = `Sukses: ${data.message}. Tautan ${finalShortUrl} seharusnya sudah aktif.`;
                        serverResponseDiv.className = 'success';
                        // Kosongkan input setelah berhasil
                        longUrlInput.value = '';
                        shortCodeInput.value = '';
                        secretKeyInput.value = ''; // Atau jangan kosongkan secret key
                    } else {
                        serverResponseDiv.textContent = `Gagal: ${data.message || 'Respons tidak dikenal.'}`;
                        serverResponseDiv.className = 'error';
                    }
                })
                .catch(error => {
                    console.error("Error saat POST ke Apps Script:", error);
                    serverResponseDiv.textContent = `Error jaringan atau script: ${error.message}`;
                    serverResponseDiv.className = 'error';
                });
        }
    </script>
</body>

</html>